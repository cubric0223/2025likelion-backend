<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‚¬ìš©ì ì „ì²´ íë¦„ í…ŒìŠ¤íŠ¸</title>
  <style>
    .step { display: none; margin-top: 20px; }
    .step.active { display: block; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
<h1>ğŸ’ ì‚¬ìš©ì í†µí•© í…ŒìŠ¤íŠ¸</h1>

<!-- STEP 1: ì¸ìŠ¤íƒ€ ID ì…ë ¥ -->
<div id="step1" class="step active">
  <label>ì¸ìŠ¤íƒ€ê·¸ë¨ ì•„ì´ë””:
    <input type="text" id="instaId">
  </label>
  <br>
  <button onclick="checkId()">ë‹¤ìŒ</button>
</div>

<!-- STEP 2: ì„±ë³„ ì…ë ¥ (ì‹ ê·œ ìœ ì €) -->
<div id="step2" class="step">
  <p>ì‹ ê·œ ìœ ì €ì…ë‹ˆë‹¤. ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”:</p>
  <label><input type="radio" name="gender" value="male"> ë‚¨ì</label>
  <label><input type="radio" name="gender" value="female"> ì—¬ì</label>
  <br>
  <button onclick="signup()">íšŒì›ê°€ì…</button>
</div>

<!-- STEP 3: ë‹µë³€ ì œì¶œ -->
<div id="step3" class="step">
  <h3>ğŸ“ ë°¸ëŸ°ìŠ¤ ê²Œì„ ë‹µë³€</h3>
  <div id="questions">
    <div><p>1. ì§œì¥ë©´ vs ì§¬ë½•</p>
      <label><input type="radio" name="q1" value="FIRST"> ì§œì¥ë©´</label>
      <label><input type="radio" name="q1" value="SECOND"> ì§¬ë½•</label>
    </div>
    <div><p>2. ì—°ì„¸ëŒ€ vs ê³ ë ¤ëŒ€</p>
      <label><input type="radio" name="q2" value="FIRST"> ì—°ì„¸ëŒ€</label>
      <label><input type="radio" name="q2" value="SECOND"> ê³ ë ¤ëŒ€</label>
    </div>
    <div><p>3. ê³ ì–‘ì´ vs ê°•ì•„ì§€</p>
      <label><input type="radio" name="q3" value="FIRST"> ê³ ì–‘ì´</label>
      <label><input type="radio" name="q3" value="SECOND"> ê°•ì•„ì§€</label>
    </div>
    <div><p>4. ì—¬ë¦„ vs ê²¨ìš¸</p>
      <label><input type="radio" name="q4" value="FIRST"> ì—¬ë¦„</label>
      <label><input type="radio" name="q4" value="SECOND"> ê²¨ìš¸</label>
    </div>
    <div><p>5. ëˆ vs ëª…ì˜ˆ</p>
      <label><input type="radio" name="q5" value="FIRST"> ëˆ</label>
      <label><input type="radio" name="q5" value="SECOND"> ëª…ì˜ˆ</label>
    </div>
  </div>
  <button onclick="submitAnswers()">ë‹µë³€ ì œì¶œ</button>
</div>

<!-- ê²°ê³¼ ì¶œë ¥ -->
<div id="result" style="margin-top: 30px; color: darkblue;"></div>

<script>
  function goToStep(step) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById('step' + step).classList.add('active');
  }

  async function checkId() {
    const instaId = document.getElementById('instaId').value.trim();
    if (!instaId) {
      alert("ì¸ìŠ¤íƒ€ê·¸ë¨ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const res = await fetch("/auth/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ instaId })
    });

    const data = await res.json();
    document.getElementById("result").innerText = data.message;

    if (data.status === "done") {
      goToStep(1); // ì´ë¯¸ ì œì¶œí–ˆìœ¼ë¯€ë¡œ ë‹¤ìŒ ë‹¨ê³„ ì•ˆ ê°
      alert("ì´ë¯¸ ë‹µë³€ì„ ì œì¶œí•˜ì…¨ìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤.");
    } else if (data.isNewUser) {
      goToStep(2);
    } else {
      goToStep(3); // ê¸°ì¡´ ìœ ì € â†’ ë°”ë¡œ ì§ˆë¬¸
    }
  }

  async function signup() {
    const gender = document.querySelector('input[name="gender"]:checked')?.value;
    if (!gender) {
      alert("ì„±ë³„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const res = await fetch("/auth/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ gender })
    });

    const data = await res.json();
    document.getElementById("result").innerText = data.message;
    goToStep(3);
  }

  async function submitAnswers() {
    const answers = [];
    for (let i = 1; i <= 5; i++) {
      const selected = document.querySelector(`input[name="q${i}"]:checked`);
      if (!selected) {
        alert(`${i}ë²ˆ ì§ˆë¬¸ì— ì‘ë‹µí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
        return;
      }
      answers.push({ questionNumber: i, choice: selected.value });
    }

    const res = await fetch("/member/submit", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ answers })
    });

    const data = await res.json();
    document.getElementById("result").innerText = data.message;
    alert("ë‹µë³€ ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. 18ì‹œì— ë©‹ì‚¬ì¸ìŠ¤íƒ€ì—ì„œ ê²°ê³¼ í™•ì¸ ê°€ëŠ¥!");
    goToStep(1);
  }
</script>
</body>
</html>